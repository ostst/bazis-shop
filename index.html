<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BAZIS Store</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --accent-color: #ff5722;
            --card-dark: #1e1e1e;
            --text-main: #ffffff;
            --text-sec: #888888;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 15px;
            padding-bottom: 100px;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –®–ê–ü–ö–ê --- */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            z-index: 100;
            border-bottom: 1px solid #222;
        }

        .header-logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .store-logo-img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #333;
        }

        .logo-text { 
            font-size: 22px; 
            font-weight: 800; 
            color: var(--accent-color); 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }

        .back-btn {
            display: none;
            background: transparent;
            border: none;
            color: var(--text-main);
            font-size: 24px;
            cursor: pointer;
            padding: 0 10px;
            width: 44px;
        }

        .header-spacer { width: 44px; }
        .admin-badge { display: none; background: red; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px; }

        /* --- –ú–ï–ù–Æ --- */
        .brand-header { margin: 30px 0 15px 0; padding-bottom: 5px; border-bottom: 1px solid #333; font-size: 18px; font-weight: bold; color: #666; text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
        .brand-icon { width: 24px; height: 24px; object-fit: contain; background: #fff; border-radius: 4px; padding: 2px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .poster-card { position: relative; height: 180px; border-radius: 20px; background-color: var(--card-dark); overflow: hidden; cursor: pointer; display: flex; flex-direction: column; justify-content: space-between; padding: 15px; border: 1px solid #333; transition: transform 0.2s; }
        .poster-card:active { transform: scale(0.98); }
        .poster-card.orange { background-color: var(--accent-color); border: none; }
        .poster-card.blue { background-color: #2c3e50; border: none; }
        .card-content { position: relative; z-index: 2; pointer-events: none; }
        .card-title-big { font-size: 24px; font-weight: 700; line-height: 1; margin-bottom: 5px; color: #fff; }
        .card-subtitle { font-size: 13px; font-weight: 400; opacity: 0.8; color: #fff; }
        .card-bg-img { position: absolute; bottom: -10px; right: -20px; width: 130px; height: 130px; object-fit: contain; z-index: 1; transform: rotate(-5deg); }
        .arrow-circle { position: absolute; bottom: 12px; right: 12px; width: 32px; height: 32px; background-color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 3; }
        .poster-card .arrow-circle svg { stroke: #fff; }

        /* --- –¢–û–í–ê–†–´ –ò –°–õ–ê–ô–î–ï–† --- */
        .product-card { background: var(--card-dark); border: 1px solid #2a2a2a; border-radius: 12px; padding: 12px; margin-bottom: 15px; }
        
        .slider-container { position: relative; width: 100%; height: 240px; margin-bottom: 10px; border-radius: 8px; overflow: hidden; background: #000; }
        .slider-track { display: flex; height: 100%; transition: transform 0.3s ease; }
        .prod-img { min-width: 100%; height: 100%; object-fit: cover; }
        .slider-dots { position: absolute; bottom: 10px; left: 0; right: 0; display: flex; justify-content: center; gap: 5px; }
        .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.5); border-radius: 50%; transition: 0.2s; }
        .dot.active { background: #fff; transform: scale(1.2); }

        .prod-title { font-size: 18px; font-weight: 700; margin-bottom: 5px; line-height: 1.2; }
        .prod-price { font-size: 18px; color: var(--accent-color); font-weight: bold; margin-bottom: 10px; }
        .prod-info { font-size: 12px; color: #888; margin-bottom: 12px; }
        
        .btns-row { display: flex; gap: 10px; }
        .add-btn { flex: 1; background: #fff; color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; text-transform: uppercase; }
        .edit-btn { background: #333; color: #fff; border: 1px solid #555; padding: 12px; border-radius: 10px; cursor: pointer; display: none; }

        /* --- –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï --- */
        .edit-form-container { padding: 10px; }
        .img-preview-list { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; margin-bottom: 10px; }
        .img-preview-item { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 1px solid #444; flex-shrink: 0; }
        .form-group { margin-bottom: 15px; }
        .form-input, .form-select, .textarea-input { width: 100%; padding: 14px; background: #222; border: 1px solid #333; color: #fff; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        .textarea-input { height: 80px; resize: vertical; font-family: inherit; }
        .save-btn { background: #4caf50; color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; margin-top: 20px; }

        /* --- –ö–û–†–ó–ò–ù–ê --- */
        .cart-item { background: #111; border-radius: 12px; margin-bottom: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .checkout-btn-visible { display: none; background: var(--accent-color); color: #fff; width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 18px; font-weight: 800; text-transform: uppercase; cursor: pointer; margin-top: 25px; }
        
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        .fab-cart { position: fixed; bottom: 25px; right: 20px; background: var(--accent-color); color: white; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 20px rgba(255, 87, 34, 0.3); z-index: 200; font-size: 24px; }
        .cart-count { position: absolute; top: -5px; right: -5px; background: white; color: var(--accent-color); font-size: 12px; font-weight: bold; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <!-- –®–ê–ü–ö–ê -->
    <div class="header">
        <button id="backBtn" class="back-btn" onclick="goBack()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <div class="header-logo-container" onclick="toggleAdminMode()">
            <img src="img/logo_bazis.jpeg" class="store-logo-img" alt="Logo">
            <div class="logo-text">BAZIS</div>
            <div id="adminBadge" class="admin-badge">ADMIN</div>
        </div>
        <div class="header-spacer"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 1: –ú–ï–ù–Æ -->
    <div id="homePage" class="page active">
        <div class="brand-header"><img src="img/stone island.jpg" class="brand-icon">STONE ISLAND</div>
        <div class="grid">
            <div class="poster-card" onclick="openCategory('Stone Island', 'T-Shirts')">
                <div class="card-content"><div class="card-title-big">–§—É—Ç–±–æ–ª–∫–∏</div><div class="card-subtitle">–§—É—Ç–±–æ–ª–∫–∏ –∏ –ø–æ–ª–æ</div></div>
                <img src="img/t-shirts.png" class="card-bg-img">
                <div class="arrow-circle"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
            </div>
            <div class="poster-card" onclick="openCategory('Stone Island', 'Hoodies')">
                 <div class="card-content"><div class="card-title-big">–•—É–¥–∏</div><div class="card-subtitle">–°–≤–∏—Ç—à–æ—Ç—ã –∏ —Ö—É–¥–∏</div></div>
                <img src="img/hoodies.png" class="card-bg-img">
                <div class="arrow-circle"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
            </div>
            <div class="poster-card orange" style="grid-column: span 2;" onclick="openCategory('Stone Island', 'Vintage')">
                <div class="card-content"><div class="card-title-big" style="font-size: 32px;">–í–∏–Ω—Ç–∞–∂</div><div class="card-subtitle">–†–µ–¥–∫–∏–µ –∏ –í–∏–Ω—Ç–∞–∂–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</div></div>
                <img src="img/vintag.png" class="card-bg-img" style="width: 150px;">
                <div class="arrow-circle"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
            </div>
             <div class="poster-card" onclick="openCategory('Stone Island', 'Outerwear')">
                 <div class="card-content"><div class="card-title-big">–í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞</div><div class="card-subtitle">–ö—É—Ä—Ç–∫–∏, –ø–ª–∞—â–∏</div></div>
                <img src="img/jackets.png" class="card-bg-img">
                <div class="arrow-circle"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
            </div>
             <div class="poster-card" onclick="openCategory('Stone Island', 'Accessories')">
                 <div class="card-content"><div class="card-title-big">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</div><div class="card-subtitle">–ö–µ–ø–∫–∏, —Ä–µ–º–Ω–∏</div></div>
                <img src="img/access.png" class="card-bg-img">
                <div class="arrow-circle"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
            </div>
        </div>
        <div class="brand-header" style="margin-top: 40px;"><img src="img/c. p. company.jpg" class="brand-icon">C.P. COMPANY</div>
        <div class="grid">
             <div class="poster-card blue" style="grid-column: span 2;" onclick="openCategory('CP Company', 'Outerwear')">
                 <div class="card-content"><div class="card-title-big">Metropolis</div><div class="card-subtitle">Urban Protection Series</div></div>
                <img src="https://cdn-images.farfetch-contents.com/19/52/47/48/19524748_43431995_1000.jpg" class="card-bg-img" style="width: 160px;">
                <div class="arrow-circle"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
            </div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù 2: –¢–û–í–ê–†–´ -->
    <div id="productsPage" class="page">
        <h2 id="categoryTitle" style="margin-bottom: 20px; font-size: 22px;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h2>
        <div id="productsList"></div>
    </div>

    <!-- –≠–ö–†–ê–ù 3: –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï -->
    <div id="editPage" class="page">
        <h2 style="margin-bottom: 20px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <div class="edit-form-container">
            <input type="hidden" id="editId">
            <div class="form-group"><label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (URL, –∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label><textarea class="form-input textarea-input" id="editImages" placeholder="https://..."></textarea><div id="editImagesPreview" class="img-preview-list"></div></div>
            <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" class="form-input" id="editTitle"></div>
            <div class="form-group"><label>–¶–µ–Ω–∞ (‚ÇΩ)</label><input type="number" class="form-input" id="editPrice"></div>
            <div class="form-group"><label>–†–∞–∑–º–µ—Ä</label><input type="text" class="form-input" id="editSize"></div>
            <div class="form-group"><label>–°–æ—Å—Ç–æ—è–Ω–∏–µ</label><input type="text" class="form-input" id="editCondition"></div>
            <button class="save-btn" onclick="saveProduct()">–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø</button>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù 4: –ö–û–†–ó–ò–ù–ê -->
    <div id="cartPage" class="page">
        <h2 style="margin-bottom: 20px;">–í–∞—à –∑–∞–∫–∞–∑</h2>
        <div id="cartItemsList"></div>
        <div style="border-top: 1px solid #333; margin: 30px 0;"></div>
        <h3 style="margin-bottom: 15px; color: var(--accent-color)">–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</h3>
        <div class="form-group"><input type="text" class="form-input" id="inputName" placeholder="–ò–º—è –§–∞–º–∏–ª–∏—è (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></div>
        <div class="form-group"><input type="tel" class="form-input" id="inputPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></div>
        <div class="form-group"><input type="text" class="form-input" id="inputNick" placeholder="–ù–∏–∫ –≤ Telegram (@username)"></div>
        <div class="form-group"><select class="form-select" id="inputDelivery"><option value="cdek">–°–î–≠–ö (–¥–æ –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏)</option><option value="yandex">–Ø–Ω–¥–µ–∫—Å –î–æ—Å—Ç–∞–≤–∫–∞</option><option value="pickup">–°–∞–º–æ–≤—ã–≤–æ–∑ (–ú–æ—Å–∫–≤–∞)</option></select></div>
        <button class="checkout-btn-visible" onclick="submitOrder()">–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–ö–ê–ó</button>
    </div>

    <div class="fab-cart" onclick="openCart()">üõí<div class="cart-count" id="cartCount">0</div></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); tg.ready();
        tg.setHeaderColor('#0f0f0f'); tg.setBackgroundColor('#0f0f0f');

        let PRODUCTS_DB = [];
        let cart = [];
        let isAdmin = false;
        let currentCategoryParams = { brand: null, cat: null };
        let logoTapCount = 0;

        // --- –ó–ê–ì–†–£–ó–ö–ê ---
        async function fetchProducts() {
            try {
                const response = await fetch('/api/products');
                PRODUCTS_DB = await response.json();
            } catch (error) { console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error); }
        }
        fetchProducts();

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            const backBtn = document.getElementById('backBtn');
            if (pageId === 'homePage') { backBtn.style.display = 'none'; tg.MainButton.hide(); } 
            else { backBtn.style.display = 'block'; }
            if (pageId === 'cartPage') updateCartUI(); 
            else tg.MainButton.hide();
            window.scrollTo(0,0);
        }
        function goBack() { 
            if(document.querySelector('.page.active').id === 'editPage') openCategory(currentCategoryParams.brand, currentCategoryParams.cat);
            else goHome(); 
        }
        function goHome() { showPage('homePage'); }

        // --- –ê–î–ú–ò–ù–ö–ê ---
        function toggleAdminMode() {
            logoTapCount++;
            if (logoTapCount >= 5) { // 5 –Ω–∞–∂–∞—Ç–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
                isAdmin = !isAdmin;
                logoTapCount = 0;
                document.getElementById('adminBadge').style.display = isAdmin ? 'inline-block' : 'none';
                tg.HapticFeedback.notificationOccurred('success');
                if(document.getElementById('productsPage').classList.contains('active')) openCategory(currentCategoryParams.brand, currentCategoryParams.cat);
            }
        }

        // --- –ö–ê–¢–ê–õ–û–ì ---
        function openCategory(brand, category) {
            currentCategoryParams = { brand, cat: category };
            const list = document.getElementById('productsList');
            document.getElementById('categoryTitle').innerHTML = `<span style="color:#888">${brand}</span> ${category}`;
            list.innerHTML = '';
            const items = PRODUCTS_DB.filter(p => p.brand === brand && p.category === category);
            
            if (items.length === 0) list.innerHTML = '<div style="text-align:center; padding:40px; color:#555">–ü—É—Å—Ç–æ üå™</div>';
            
            items.forEach(item => {
                const el = document.createElement('div');
                el.className = 'product-card';
                let slidesHtml = '', dotsHtml = '';
                if(item.images && item.images.length > 0) {
                    item.images.forEach((src, idx) => {
                        slidesHtml += `<img src="${src}" class="prod-img">`;
                        dotsHtml += `<div class="dot ${idx===0?'active':''}"></div>`;
                    });
                } else { slidesHtml = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#555">NO PHOTO</div>'; }

                const editButtonHtml = isAdmin ? `<button class="edit-btn" style="display:block" onclick="openEditPage(${item.id})">‚úèÔ∏è</button>` : '';

                el.innerHTML = `
                    <div class="slider-container" onclick="nextSlide(this)">
                        <div class="slider-track" style="width: ${Math.max(1, item.images.length) * 100}%;">${slidesHtml}</div>
                        <div class="slider-dots">${dotsHtml}</div>
                    </div>
                    <div class="prod-title">${item.title}</div>
                    <div class="prod-price">${item.price.toLocaleString()} ‚ÇΩ</div>
                    <div class="prod-info">–†–∞–∑–º–µ—Ä: ${item.size} | –°–æ—Å—Ç: ${item.condition}</div>
                    <div class="btns-row"><button class="add-btn" onclick="addToCart(${item.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>${editButtonHtml}</div>
                `;
                list.appendChild(el);
            });
            showPage('productsPage');
        }

        function nextSlide(container) {
            const track = container.querySelector('.slider-track');
            const dots = container.querySelectorAll('.dot');
            if(dots.length <= 1) return;
            
            let currentTransform = track.style.transform || 'translateX(0%)';
            let currentPercent = (currentTransform.match(/translateX\(-?([\d.]+)%\)/) || [0,0])[1];
            let currentIdx = Math.round(parseFloat(currentPercent) / (100 / dots.length));
            let nextIdx = (currentIdx + 1) % dots.length;

            track.style.transform = `translateX(-${nextIdx * (100 / dots.length)}%)`;
            dots.forEach(d => d.classList.remove('active'));
            dots[nextIdx].classList.add('active');
        }

        // --- –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï ---
        function openEditPage(id) {
            const p = PRODUCTS_DB.find(x => x.id === id);
            if(!p) return;
            document.getElementById('editId').value = p.id;
            document.getElementById('editTitle').value = p.title;
            document.getElementById('editPrice').value = p.price;
            document.getElementById('editSize').value = p.size;
            document.getElementById('editCondition').value = p.condition;
            document.getElementById('editImages').value = p.images.join('\n');
            updatePreview(p.images);
            showPage('editPage');
        }

        document.getElementById('editImages').addEventListener('input', (e) => updatePreview(e.target.value.split(/[\n,]+/).map(u=>u.trim()).filter(u=>u)));
        function updatePreview(urls) {
            const c = document.getElementById('editImagesPreview'); c.innerHTML = '';
            urls.forEach(url => { const i=document.createElement('img'); i.src=url; i.className='img-preview-item'; c.appendChild(i); });
        }

        function saveProduct() {
            const id = parseInt(document.getElementById('editId').value);
            const imgArray = document.getElementById('editImages').value.split(/[\n,]+/).map(u => u.trim()).filter(u => u.length > 0);
            
            const updatedData = {
                id: id,
                title: document.getElementById('editTitle').value,
                price: parseInt(document.getElementById('editPrice').value),
                size: document.getElementById('editSize').value,
                condition: document.getElementById('editCondition').value,
                images: imgArray
            };

            fetch('/api/update_product', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(updatedData)
            }).then(r => r.json()).then(data => {
                if(data.status === 'ok') {
                    tg.showPopup({message: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!'});
                    fetchProducts(); // –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
                    goBack();
                } else { tg.showPopup({message: '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'}); }
            });
        }

        // --- –ö–û–†–ó–ò–ù–ê ---
        function addToCart(id) { const p = PRODUCTS_DB.find(x => x.id === id); if(p) { cart.push(p); updateCartUI(); tg.HapticFeedback.notificationOccurred('success'); }}
        function updateCartUI() {
            document.getElementById('cartCount').innerText = cart.length;
            if (cart.length > 0) { tg.MainButton.setText(`–ó–ê–ö–ê–ó–ê–¢–¨ ‚Ä¢ ${cart.reduce((a,b)=>a+b.price,0).toLocaleString()} ‚ÇΩ`); tg.MainButton.show(); tg.MainButton.onClick(submitOrder); } 
            else { tg.MainButton.hide(); }
        }
        function openCart() { renderCartPage(); showPage('cartPage'); }
        function renderCartPage() {
            const list = document.getElementById('cartItemsList'); const btn = document.querySelector('.checkout-btn-visible'); list.innerHTML = '';
            if (cart.length === 0) { list.innerHTML = '<div style="text-align:center; padding:40px; color:#555">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>'; btn.style.display = 'none'; return; }
            btn.style.display = 'block';
            cart.forEach((item, index) => {
                list.innerHTML += `<div class="cart-item"><div><div style="font-weight:bold;">${item.title}</div><div style="font-size:12px;color:#888">${item.size} | ${item.price} ‚ÇΩ</div></div><div style="color:#ff3b30;font-size:24px;padding:0 10px;cursor:pointer" onclick="cart.splice(${index},1);updateCartUI();renderCartPage()">√ó</div></div>`;
            });
        }

        // --- –ó–ê–ö–ê–ó ---
        function submitOrder() {
            const name = document.getElementById('inputName').value;
            const phone = document.getElementById('inputPhone').value;
            if (!name || !phone) { tg.showPopup({title: '–û—à–∏–±–∫–∞', message: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ò–º—è –∏ –¢–µ–ª–µ—Ñ–æ–Ω'}); return; }
            
            const userId = tg.initDataUnsafe?.user?.id;

            const orderData = {
                user_id: userId,
                customer: { name, phone, nick: document.getElementById('inputNick').value, delivery: document.getElementById('inputDelivery').value },
                items: cart,
                total: cart.reduce((s, i) => s + i.price, 0)
            };

            fetch('/api/order', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(orderData) })
            .then(r => { if(r.ok) tg.close(); else tg.showPopup({message: '–û—à–∏–±–∫–∞'}); }).catch(e => console.error(e));
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BAZIS Store</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* СБРОС СТИЛЕЙ И БАЗА */
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #1a1a1a); /* Темный фон по умолчанию */
            color: var(--tg-theme-text-color, #ffffff);
        }

        .header {
            padding: 20px;
            text-align: center;
            background-color: var(--tg-theme-secondary-bg-color, #2c2c2c);
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .header h1 {
            margin: 0; font-size: 24px; text-transform: uppercase; letter-spacing: 2px; font-weight: 800;
        }

        /* СЕТКА ТОВАРОВ */
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Две колонки */
            gap: 12px;
            padding: 0 12px 80px 12px; /* Отступ снизу, чтобы кнопка не перекрывала товары */
        }

        .card {
            background-color: var(--tg-theme-secondary-bg-color, #2c2c2c);
            border-radius: 12px;
            overflow: hidden;
            display: flex; flex-direction: column;
            position: relative;
        }

        .image-placeholder {
            width: 100%;
            height: 160px;
            background-color: #444;
            display: flex; align-items: center; justify-content: center;
            color: #888; font-size: 12px;
        }

        /* Если будете вставлять реальные фото, используйте тег img вместо div выше */
        .card img { width: 100%; height: 160px; object-fit: cover; }

        .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 14px; margin-bottom: 5px; font-weight: 600; }
        .card-price { font-size: 16px; font-weight: bold; margin-top: auto; color: var(--tg-theme-button-color, #3390ec); }

        /* КНОПКА ДОБАВИТЬ */
        .add-btn {
            margin-top: 10px;
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 6px;
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .add-btn:active { opacity: 0.8; }

        /* СЧЕТЧИК НА ТОВАРЕ */
        .counter {
            position: absolute; top: 8px; right: 8px;
            background: #3390ec; color: white;
            border-radius: 50%; width: 24px; height: 24px;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold;
            display: none; /* Скрыт по умолчанию */
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>BAZIS</h1>
    </div>

    <div class="container" id="items-list">
        <!-- Товары генерируются тут -->
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // На весь экран

        // БАЗА ТОВАРОВ (Имитация БД)
        const products = [
            {id: 1, name: 'Футболка Oversize', price: 2500, img: 'https://via.placeholder.com/300x300/333/fff?text=T-Shirt'},
            {id: 2, name: 'Худи Basic Black', price: 4900, img: 'https://via.placeholder.com/300x300/333/fff?text=Hoodie'},
            {id: 3, name: 'Брюки Cargo', price: 5500, img: 'https://via.placeholder.com/300x300/333/fff?text=Pants'},
            {id: 4, name: 'Кепка BAZIS', price: 1500, img: 'https://via.placeholder.com/300x300/333/fff?text=Cap'},
            {id: 5, name: 'Носки Pack (3 шт)', price: 900, img: 'https://via.placeholder.com/300x300/333/fff?text=Socks'},
            {id: 6, name: 'Бомбер Urban', price: 8900, img: 'https://via.placeholder.com/300x300/333/fff?text=Bomber'},
        ];

        const cart = {}; // Хранит {id: количество}

        // ОТРИСОВКА ТОВАРОВ
        const list = document.getElementById('items-list');
        products.forEach(item => {
            const el = document.createElement('div');
            el.className = 'card';
            el.innerHTML = `
                <span class="counter" id="cnt-${item.id}">0</span>
                <img src="${item.img}" alt="${item.name}">
                <div class="card-body">
                    <div class="card-title">${item.name}</div>
                    <div class="card-price">${item.price} ₽</div>
                    <button class="add-btn" onclick="addItem(${item.id})">В корзину</button>
                </div>
            `;
            list.appendChild(el);
        });

        // ЛОГИКА КОРЗИНЫ
        function addItem(id) {
            if (!cart[id]) cart[id] = 0;
            cart[id]++;

            // Обновляем счетчик на карточке
            const counter = document.getElementById(`cnt-${id}`);
            counter.style.display = 'flex';
            counter.innerText = cart[id];

            // Вибрация при нажатии (приятный тактильный отклик)
            tg.HapticFeedback.impactOccurred('light');

            updateMainButton();
        }

        function updateMainButton() {
            let totalSum = 0;
            let itemsCount = 0;

            for (let id in cart) {
                const product = products.find(p => p.id == id);
                totalSum += product.price * cart[id];
                itemsCount += cart[id];
            }

            if (itemsCount > 0) {
                tg.MainButton.setText(`ОФОРМИТЬ ЗАКАЗ: ${totalSum} ₽`);
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
            }
        }

        // ОТПРАВКА ДАННЫХ БОТУ
        tg.MainButton.onClick(function() {
            // Собираем красивый список для отправки
            const dataToSend = [];
            for (let id in cart) {
                const product = products.find(p => p.id == id);
                dataToSend.push({
                    name: product.name,
                    count: cart[id],
                    total: product.price * cart[id]
                });
            }
            tg.sendData(JSON.stringify(dataToSend));
        });
    </script>
</body>
</html>
